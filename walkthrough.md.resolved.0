# MQTT Proxy Debugging Walkthrough

## Resolution Summary
We traced a crashing bug in [tcp-mqtt-proxy.py](file:///C:/Users/dremb/.gemini/antigravity/brain/cd00e979-2d9a-4abd-80d8-38d6d36e6d90/tcp-mqtt-proxy.py) to a positional argument mismatch when initializing the Meshtastic library's [TCPInterface](file:///C:/Users/dremb/.gemini/antigravity/brain/cd00e979-2d9a-4abd-80d8-38d6d36e6d90/tcp-mqtt-proxy.py#381-407). The proxy was passing the port number (`4404`) as the second argument, which the library interpreted as the `debugOut` stream. This caused the library to attempt `4404.write(...)`, resulting in an `AttributeError`.

**The fix was to pass the port number as a keyword argument (`portNumber=TCP_NODE_PORT`). using the corrected initialization.**

## Verification
### 1. Connection Test
We verified the fix by running a test script [test_fix_v2.py](file:///C:/Users/dremb/.gemini/antigravity/brain/cd00e979-2d9a-4abd-80d8-38d6d36e6d90/test_fix_v2.py) on the live server, which successfully connected to the Meshtastic node without crashing.

### 2. Live Proxy Validation
The patched [tcp-mqtt-proxy.py](file:///C:/Users/dremb/.gemini/antigravity/brain/cd00e979-2d9a-4abd-80d8-38d6d36e6d90/tcp-mqtt-proxy.py) was deployed to the server and the Docker container was rebuilt.
**Logs confirm successful packet forwarding:**
```text
mqtt-proxy  | ... [INFO] tcp-mqtt-proxy: Publishing to MQTT: Topic=msh/US/2/e/LongFast/!5ec28197 ...
```

## Applied Changes
### [tcp-mqtt-proxy.py](file:///mqttgateway/home/pi/MeshMonitor/mqttgateway/tcp-mqtt-proxy.py)
- Updated [RawTCPInterface](file:///C:/Users/dremb/.gemini/antigravity/brain/cd00e979-2d9a-4abd-80d8-38d6d36e6d90/tcp-mqtt-proxy.py#381-407) initialization to use `portNumber` keyword argument.

```python
            # Use our custom RawTCPInterface
            iface = RawTCPInterface(
                TCP_NODE_HOST,
                portNumber=TCP_NODE_PORT,  # FIXED: Passed as keyword arg
                timeout=300 
            )
```
