============================= test session starts =============================
platform win32 -- Python 3.14.2, pytest-7.4.3, pluggy-1.6.0 -- C:\Users\dremb\AppData\Local\Python\pythoncore-3.14-64\python.exe
cachedir: .pytest_cache
rootdir: E:\proj\AiAssited\mqtt-proxy
plugins: anyio-3.7.1, cov-4.1.0
collecting ... collected 10 items

tests/test_mqtt_extended.py::test_mqtt_configure_minimal FAILED          [ 10%]
tests/test_mqtt_extended.py::test_mqtt_configure_tls FAILED              [ 20%]
tests/test_mqtt_extended.py::test_mqtt_start_invalid_address PASSED      [ 30%]
tests/test_mqtt_extended.py::test_mqtt_publish_failure PASSED            [ 40%]
tests/test_mqtt_extended.py::test_mqtt_on_connect_failure PASSED         [ 50%]
tests/test_mqtt_extended.py::test_mqtt_on_disconnect_unexpected PASSED   [ 60%]
tests/test_mqtt_extended.py::test_mqtt_on_message_stat PASSED            [ 70%]
tests/test_mqtt_extended.py::test_mqtt_on_message_own PASSED             [ 80%]
tests/test_mqtt_extended.py::test_mqtt_on_message_mesh_packet_fallback PASSED [ 90%]
tests/test_mqtt_extended.py::test_mqtt_on_message_exception_handling PASSED [100%]

================================== FAILURES ===================================
_________________________ test_mqtt_configure_minimal _________________________

    def test_mqtt_configure_minimal():
        config = MagicMock()
        handler = MQTTHandler(config, "1234abcd")
    
        # Minimal config (no address)
        node_cfg = MagicMock()
        node_cfg.enabled = True
        node_cfg.address = None
    
        handler.configure(node_cfg)
        assert handler.mqtt_address is None
>       assert handler.mqtt_port == 1883
E       assert 1 == 1883
E        +  where 1 = <handlers.mqtt.MQTTHandler object at 0x0000019122780980>.mqtt_port

tests\test_mqtt_extended.py:19: AssertionError
___________________________ test_mqtt_configure_tls ___________________________

    def test_mqtt_configure_tls():
        config = MagicMock()
        handler = MQTTHandler(config, "1234abcd")
    
        node_cfg = MagicMock()
        node_cfg.enabled = True
        node_cfg.address = "mqtt.meshtastic.org"
        node_cfg.tlsEnabled = True
    
        with patch('ssl.create_default_context') as mock_ssl:
            handler.configure(node_cfg)
>           assert handler.mqtt_port == 8883
E           assert 1 == 8883
E            +  where 1 = <handlers.mqtt.MQTTHandler object at 0x0000019121FCC7D0>.mqtt_port

tests\test_mqtt_extended.py:32: AssertionError
=========================== short test summary info ===========================
FAILED tests/test_mqtt_extended.py::test_mqtt_configure_minimal - assert 1 ==...
FAILED tests/test_mqtt_extended.py::test_mqtt_configure_tls - assert 1 == 8883
========================= 2 failed, 8 passed in 0.42s =========================
